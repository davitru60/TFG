<form [formGroup]="form" (ngSubmit)="submitForm()" class="w-full mx-auto bg-white p-8 lg:w-3/4">
  <!-- Botones de acción -->

  <app-button-group
  (addImageField)="addImageField()"
  (addTextEditor)="addTextEditor()"
  (addTextImageField)="addTextImageField()"
  (submitForm)="submitForm()"
  ></app-button-group>


  <!-- Campos dinámicos -->
  <div formArrayName="dynamicFields" class="space-y-6" cdkDropList (cdkDropListDropped)="onDrop($event)">
    <div *ngFor="let field of dynamicFields.controls; let i = index" [formGroupName]="i" class="p-4" cdkDrag
      [cdkDragDisabled]="isEditingText">
      <div class="flex flex-col md:flex-row items-center justify-between space-y-4 md:space-y-0">
        <ng-container [ngSwitch]="field.get('type')?.value">

          
          <!-- Campo de imagen -->
          <div *ngSwitchCase="'image'" class="w-full md:w-1/2">
            @if(!dynamicFields.at(i).get('path')?.value){
              <ng-container>
                <label class="block text-gray-700 font-bold">Imagen:</label>
                <input
                  type="file"
                  [formControlName]="'value'"
                  (change)="onFileChange($event, i)"
                  class="w-full p-3 border border-gray-300 focus:outline-none focus:border-blue-500 transition duration-200"
                />
              </ng-container>
            }
          
          
            <div *ngIf="dynamicFields.at(i).get('path')?.value">
              <label class="font-bold">Previsualización:</label>
              <img
                [src]="dynamicFields.at(i).get('path')?.value"
                alt="Vista previa de imagen"
                class="max-w-full h-auto"
              />
              <button (click)="openModal()" class="mt-2 p-2 bg-blue-500 text-white rounded">Editar</button>
            </div>
          </div>
          
          <app-modal [isModalOpen]="isModalOpen" (closeEvent)="closeModal()">
            <label class="block text-gray-700 font-bold">Subir nueva imagen:</label>
            <input
              type="file"
              (change)="onFileChange($event, i)"
              class="w-full p-3 border border-gray-300 focus:outline-none focus:border-blue-500 transition duration-200"
            />
          </app-modal>

          <!-- Editor de texto -->
          <div *ngSwitchCase="'editor'" class="w-full">
            <label class="block text-gray-700 font-bold">Título:</label>
            <input id="editorTitle" type="text" [formControlName]="'title'"
              class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition duration-200 mb-4"
              placeholder="Ingrese el título" />
            <label class="block text-gray-700 font-bold">Contenido:</label>
            <quill-editor [formControlName]="'content'" [modules]="editorModules" (mouseenter)="isEditingText = true"
              (mouseleave)="isEditingText = false" class="w-full border border-gray-300 rounded-lg"></quill-editor>
          </div>

          <!-- Campo de texto e imagen -->
          <div *ngSwitchCase="'text-image'" class="w-full md:w-1/2">
            <div class="flex flex-col space-y-4">
              <label class="block text-gray-700 font-bold">Texto:</label>
              <input [formControlName]="'text'" placeholder="Ingrese texto"
                class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition duration-200" />

              <label class="block text-gray-700 font-bold">Imagen:</label>
              <input [formControlName]="'image'" type="file" (change)="onFileChange($event, i)"
                class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition duration-200" />
            </div>
          </div>
        </ng-container>

        <!-- Botón para eliminar el campo -->
        <div class="w-full md:w-auto mt-4 md:mt-0">
          <button type="button" (click)="removeField(i)"
            class="text-white bg-red-500 hover:bg-red-600 px-3 py-2 rounded-md transition duration-200">
            Eliminar
          </button>
        </div>
      </div>
    </div>
  </div>
</form>



